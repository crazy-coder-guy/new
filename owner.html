<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grelo Home Page</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
       .alert {
            display: none;
        }
        .product-list, .product-detail {
            margin-top: 30px;
        }
        .product-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .product-card img {
            width: 100%;
            height: auto;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .product-info h3 {
            font-size: 1.25rem;
        }
        .product-info .price {
            font-weight: bold;
            color: #28a745;
        }
        .btn-buy {
            margin-top: 10px;
        }
        @media (max-width: 768px) {
            .product-card {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="mt-5">Add Product</h2>
        <form id="add-product-form" class="mt-4">
            <div class="form-group">
                <label for="productType">Product Type</label>
                <select id="productType" class="form-control">
                    <option value="vegetable">Vegetable</option>
                    <option value="fruit">Fruit</option>
                </select>
            </div>
            <div class="form-group">
                <label for="productName">Product Name</label>
                <input type="text" id="productName" class="form-control" placeholder="Enter product name">
            </div>
            <div class="form-group">
                <label for="productPrice">Price ($)</label>
                <input type="number" id="productPrice" class="form-control" placeholder="Enter product price" step="0.01">
            </div>
            <div class="form-group">
                <label for="productQuantity">Quantity</label>
                <div class="form-row">
                    <div class="col">
                        <input type="number" id="productQuantity" class="form-control" placeholder="Enter quantity" step="0.01">
                    </div>
                    <div class="col">
                        <select id="quantityUnit" class="form-control">
                            <option value="g">grams</option>
                            <option value="kg">kilograms</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="productStore">Store</label>
                <input type="text" id="productStore" class="form-control" placeholder="Enter store name">
            </div>
            <div class="form-group">
                <label for="productImage">Product Image</label>
                <input type="file" id="productImage" class="form-control-file">
            </div>
            <button type="submit" class="btn btn-primary">Add Product</button>
            <div id="feedback" class="alert mt-3" role="alert"></div>
        </form>
        <div class="container">
            <form id="add-product-form" class="mt-4">
                <!-- Form elements -->
            </form>
    
            <h2 class="mt-5">Product List</h2>
            <div id="productList" class="row product-list"></div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getDatabase, ref, set, push, remove, onValue } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAKft0GluY81Wr7yCg23rk_d24iqSUAGzI",
            authDomain: "farmer-s-app-6ba74.firebaseapp.com",
            databaseURL: "https://farmer-s-app-6ba74-default-rtdb.firebaseio.com",
            projectId: "farmer-s-app-6ba74",
            storageBucket: "farmer-s-app-6ba74.appspot.com",
            messagingSenderId: "304658952728",
            appId: "1:304658952728:web:cfe48a70585fdb91d5c96d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const storage = getStorage(app);

        function renderProducts(snapshot) {
            const productList = document.getElementById('productList');
            productList.innerHTML = ''; // Clear existing products
            snapshot.forEach(childSnapshot => {
                const product = childSnapshot.val();
                const productId = childSnapshot.key;
                const productDiv = document.createElement('div');
                productDiv.className = 'product-card';
                productDiv.innerHTML = `
                    <img src="${product.imageUrl || 'https://via.placeholder.com/150'}" alt="${product.name}">
                    <div class="product-info">
                        <h3>${product.name} (${product.type})</h3>
                        <p class="price">Price: $${product.price}</p>
                        <p>Quantity: ${product.quantity} ${product.unit}</p>
                        <p>Store: ${product.store}</p>
                        <button class="btn btn-danger" onclick="removeProduct('${productId}')">Remove</button>
                    </div>
                `;
                productList.appendChild(productDiv);
            });
        }

        const productsRef = ref(db, 'products');
        onValue(productsRef, (snapshot) => {
            renderProducts(snapshot);
        });

        document.getElementById('add-product-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const productType = document.getElementById('productType').value;
            const productName = document.getElementById('productName').value;
            const productPrice = parseFloat(document.getElementById('productPrice').value);
            const productQuantity = parseFloat(document.getElementById('productQuantity').value);
            const quantityUnit = document.getElementById('quantityUnit').value;
            const productStore = document.getElementById('productStore').value;
            const productImage = document.getElementById('productImage').files[0];

            const feedback = document.getElementById('feedback');

            try {
                let imageUrl = '';

                if (productImage) {
                    const imageRef = storageRef(storage, `product_images/${Date.now()}_${productImage.name}`);
                    await uploadBytes(imageRef, productImage);
                    imageUrl = await getDownloadURL(imageRef);
                }

                const newProductRef = push(ref(db, 'products'));
                await set(newProductRef, {
                    type: productType,
                    name: productName,
                    price: productPrice,
                    quantity: productQuantity,
                    unit: quantityUnit,
                    store: productStore,
                    imageUrl: imageUrl, // Add image URL
                    timestamp: new Date().toISOString()
                });

                feedback.textContent = 'Product added successfully!';
                feedback.className = 'alert alert-success mt-3';
                feedback.style.display = 'block';

                // Fade out the feedback message after 5 seconds
                setTimeout(() => {
                    feedback.classList.add('fade-out');
                    setTimeout(() => {
                        feedback.style.display = 'none';
                        feedback.classList.remove('fade-out');
                    }, 500); // Match the fade-out duration
                }, 5000);

                document.getElementById('add-product-form').reset();
            } catch (error) {
                console.error('Error adding product:', error);
                feedback.textContent = `Error adding product: ${error.message}`;
                feedback.className = 'alert alert-danger mt-3';
                feedback.style.display = 'block';

                // Fade out the feedback message after 5 seconds
                setTimeout(() => {
                    feedback.classList.add('fade-out');
                    setTimeout(() => {
                        feedback.style.display = 'none';
                        feedback.classList.remove('fade-out');
                    }, 500); // Match the fade-out duration
                }, 5000);
            }
        });

        window.removeProduct = async (productId) => {
            try {
                await remove(ref(db, `products/${productId}`));
                const feedback = document.getElementById('feedback');
                feedback.textContent = 'Product removed successfully!';
                feedback.className = 'alert alert-success mt-3';
                feedback.style.display = 'block';

                // Fade out the feedback message after 5 seconds
                setTimeout(() => {
                    feedback.classList.add('fade-out');
                    setTimeout(() => {
                        feedback.style.display = 'none';
                        feedback.classList.remove('fade-out');
                    }, 500); // Match the fade-out duration
                }, 5000);
            } catch (error) {
                console.error('Error removing product:', error);
                const feedback = document.getElementById('feedback');
                feedback.textContent = `Error removing product: ${error.message}`;
                feedback.className = 'alert alert-danger mt-3';
                feedback.style.display = 'block';

                // Fade out the feedback message after 5 seconds
                setTimeout(() => {
                    feedback.classList.add('fade-out');
                    setTimeout(() => {
                        feedback.style.display = 'none';
                        feedback.classList.remove('fade-out');
                    }, 500); // Match the fade-out duration
                }, 5000);
            }
        };
    </script>
</body>
</html>
